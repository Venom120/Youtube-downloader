#:kivy 2.0
#:import hex kivy.utils.get_color_from_hex

# ==================== CUSTOM BUTTON STYLE ====================
<RoundedButton@Button>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    canvas.before:
        Color:
            rgba: self.bg_color if hasattr(self, 'bg_color') else (0.2, 0.2, 0.8, 1)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [10]

# ==================== VIDEO CARD WIDGET ====================
<VideoCard>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(112)
    padding: 0
    spacing: 0
    canvas.before:
        Color:
            rgba: hex('#2b2b2b')
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [10]
    
    # Thumbnail Section (25% width)
    BoxLayout:
        size_hint_x: 0.25
        orientation: 'vertical'
        padding: 0
        spacing: 0
        
        AsyncImage:
            id: thumbnail
            size_hint: 1, 1
            allow_stretch: True
            keep_ratio: True
            source: root.video_thumbnail
            canvas.before:
                Color:
                    rgba: hex('#1a1a1a')
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [8, 0, 0, 8]
        
        # Playlist/Duration Badge (overlay on thumbnail)
        FloatLayout:
            size_hint_y: None
            height: 0
            
            Label:
                id: badge
                text: root.badge_text
                size_hint: None, None
                size: self.texture_size[0] + dp(10), dp(20)
                pos_hint: {'right': 0.95, 'top': 19}
                color: 1, 1, 1, 1
                font_size: sp(9)
                bold: True
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.8
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [4]
    
    # Details Section (Takes remaining width)
    BoxLayout:
        orientation: 'vertical'
        padding: dp(8)
        spacing: dp(4)
        
        # Title Section
        Button:
            id: title_btn
            text: root.video_title
            size_hint_y: None
            height: dp(36)
            color: hex('#4da6ff')
            font_size: sp(12)
            bold: True
            halign: 'left'
            valign: 'top'
            text_size: self.width, None
            background_color: 0, 0, 0, 0
            on_release: root.on_title_click()
        
        # Channel and Info
        Label:
            text: root.video_info
            size_hint_y: None
            height: dp(20)
            color: hex('#999999')
            font_size: sp(10)
            halign: 'left'
            valign: 'top'
            text_size: self.width, None
        
        # Download Buttons Section
        BoxLayout:
            size_hint_y: None
            height: dp(36)
            spacing: dp(8)
            
            Widget:
                size_hint_x: 1
            
            RoundedButton:
                id: mp4_btn
                text: 'üì• MP4'
                size_hint_x: None
                width: dp(100)
                bg_color: hex('#cc0000')
                on_release: root.on_mp4_click()
            
            RoundedButton:
                id: mp3_btn
                text: 'üéµ MP3'
                size_hint_x: None
                width: dp(100)
                bg_color: hex('#0066cc')
                on_release: root.on_mp3_click()
            
            Widget:
                size_hint_x: 1
    
    # Progress Section (Overlay)
    FloatLayout:
        size_hint_y: None
        height: 0
        
        BoxLayout:
            id: progress_box
            orientation: 'vertical'
            size_hint_y: None
            height: 0
            opacity: 0
            spacing: dp(5)
            padding: dp(8)
            pos_hint: {'x': 0, 'y': 0}
            
            ProgressBar:
                id: progress_bar
                size_hint_y: None
                height: dp(4)
                value: 0
                max: 100
            
            Label:
                id: progress_label
                text: ''
                size_hint_y: None
                height: dp(20)
                color: hex('#999999')
                font_size: sp(10)

# ==================== MAIN APP LAYOUT ====================
<YTDownloaderApp>:
    BoxLayout:
        orientation: 'vertical'
        
        # ===== HEADER =====
        BoxLayout:
            size_hint_y: None
            height: dp(56)
            canvas.before:
                Color:
                    rgba: hex('#cc0000')
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            Label:
                text: 'üì∫ YouTube Downloader'
                font_size: sp(20)
                bold: True
                color: 1, 1, 1, 1
        
        # ===== SEARCH BAR =====
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            TextInput:
                id: search_input
                hint_text: 'Search YouTube or paste URL...'
                multiline: False
                size_hint_y: None
                height: dp(40)
                background_color: hex('#2b2b2b')
                foreground_color: 1, 1, 1, 1
                on_text_validate: root.on_search()
            
            RoundedButton:
                text: 'üîç'
                size_hint: None, None
                width: dp(50)
                height: dp(40)
                e_hint_y: None
                height: dp(40)
                on_text_validate: root.on_search()
            
            MDRaisedButton:
                text: 'üîç'
                size_hint: None, None
                width: dp(50)
                height: dp(40)
                md_bg_color: hex('#0066cc')
                on_release: root.on_search()
        
        # ===== NAVIGATION BAR =====
        BoxLayout:
            id: nav_bar
            size_hint_y: None
            height: dp(44)
            padding: dp(8)
            spacing: dp(8)
            
            Button:
                id: back_btn
                text: '‚Üê Back'
                size_hint: None, None
                width: dp(90)
                height: dp(30)
                opacity: 0
                disabled: True
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: hex('#4da6ff')
                on_release: root.back_to_search()
            
            Label:
                id: status_label
                text: 'Search for videos or paste a YouTube URL'
                color: hex('#999999')
                halign: 'left'
                valign: 'center'
                text_size: self.size
                font_size: sp(12)
            
            Widget:
                size_hint_x: 1
            
            RoundedButton:
                id: downloads_btn
                text: 'Downloads (0)'
                size_hint: None, None
                width: dp(140)
                height: dp(32)
                bg_color: hex('#0066cc')
                on_release: app.open_downloads_panel()
        
        # ===== MAIN CONTENT AREA =====
        ScrollView:
            id: scroll_view
            do_scroll_x: False
            
            GridLayout:
                id: video_grid
                cols: 1  # Will be adjusted based on screen width
                spacing: dp(10)
                padding: dp(10)
                size_hint_y: None
                height: self.minimum_height
